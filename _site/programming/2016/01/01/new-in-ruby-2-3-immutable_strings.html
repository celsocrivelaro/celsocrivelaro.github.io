<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ruby 2.3 - Immutable Strings Pragma / Frozen Strings</title>
  <meta name="description" content="Sharing a little bit of my experience and ideas.">
  <link rel="canonical" href="http://localhost:4000/programming/2016/01/01/new-in-ruby-2-3-immutable_strings.html">
  <link rel="alternate" type="application/rss+xml" title="Celso Crivelaro Feed"
    href="http://localhost:4000/feed.xml">
  
  <!-- Styles -->
  <link href="https://fonts.googleapis.com/css?family=Lato:400,400i,700,700i%7CNoto+Serif:400,400i,700,700i&display=swap" rel="stylesheet">
  <link href="/assets/css/style.css" rel="stylesheet">
</head>
<body>

  <div id="page" class="site">
    <div class="inner">
      <header class="site-header">
  
  <p class="site-title"><a class="logo-text" href="/">Celso Crivelaro</a></p>
  
  <nav class="site-navigation">
    <div class="site-navigation-wrap">
      <h2 class="screen-reader-text">Main navigation</h2>
      <ul class="menu">
        
      </ul><!-- .menu -->
      <button id="menu-close" class="menu-toggle"><span class="screen-reader-text">Close Menu</span><span
          class="icon-close" aria-hidden="true"></span></button>
    </div><!-- .site-navigation-wrap -->
  </nav><!-- .site-navigation -->
  <button id="menu-open" class="menu-toggle"><span class="screen-reader-text">Open Menu</span><span class="icon-menu" aria-hidden="true"></span></button>
</header>


      <main class="main-content fadeInDown delay_075s">

  <article class="post">
    <header class="post-header">
      <time class="post-date" datetime="2016-01-01">January 1, 2016</time>
      <h1 class="post-title">Ruby 2.3 - Immutable Strings Pragma / Frozen Strings</h1>
      <div class="post-meta">
        By <span class="post-author">John Doe</span><span class="post-tags"> in <a href="/tags/#ruby" rel="tag">ruby</a></span>
      </div><!-- .post-meta -->
      
    </header><!-- .post-header -->
    <div class="post-content">
      <p>Ruby 2.3 was released on Christmas Day - December 25th, 2015 with some great features! As a rubyst, I excited about the importance of perfomance that Ruby team is working on.</p>

<p>In this post, I’m going to talk about some new String features.</p>

<h1 id="immutable-strings-pragma">Immutable Strings Pragma</h1>

<p>By default, Ruby has mutable String objects and <code class="language-plaintext highlighter-rouge">.freeze</code> method transforms in an immutable String. Latter I’ll explain why immutable Strings are important to your Ruby code.</p>

<p>How it is hard to do for each String, the magic comment transforms all Strings to immutable in the file.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># frozen_string_literal: true</span>

<span class="s2">"Ruby"</span><span class="p">.</span><span class="nf">frozen?</span>
<span class="c1">#=&gt; true</span></code></pre></figure>

<p>Another way to have it for all your application is running on script call:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span>ruby <span class="nt">--enable-frozen-string-literal</span> <span class="nt">-e</span> <span class="s2">"puts 'a'.frozen?"</span>
<span class="nb">true</span></code></pre></figure>

<p>You probaly are wondering why to use immutable structures. Let’s face the consequences of mutable and immutable structures:</p>

<h2 id="same-strings-are-different-objects">Same strings are different objects</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="s1">'abc'</span><span class="p">.</span><span class="nf">object_id</span>
<span class="o">=&gt;</span> <span class="mi">70276411205020</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">002</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="s1">'abc'</span><span class="p">.</span><span class="nf">object_id</span>
<span class="o">=&gt;</span> <span class="mi">70276411155260</span></code></pre></figure>

<p>When these strings are frozen, i.e. immutable, they behave the same way of symbols:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">003</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="s1">'abc'</span><span class="p">.</span><span class="nf">freeze</span><span class="p">.</span><span class="nf">object_id</span>
<span class="o">=&gt;</span> <span class="mi">70276411205040</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">004</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="s1">'abc'</span><span class="p">.</span><span class="nf">freeze</span><span class="p">.</span><span class="nf">object_id</span>
<span class="o">=&gt;</span> <span class="mi">70276411205040</span></code></pre></figure>

<h2 id="string-and-string--operators">String.+@ and String.-@ operators</h2>

<p>In the context with default immutable or mutable Strings, we going to need use faster transformation operator. In order to do so, two new String operators were created:</p>

<ul>
  <li><strong>String.-@</strong> transforms mutable strings in immutable strings</li>
  <li><strong>String.+@</strong> transforms immutable strings in mutable strings</li>
</ul>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">-</span><span class="s2">"test"</span><span class="p">).</span><span class="nf">frozen?</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">002</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">+</span><span class="p">(</span><span class="s2">"teste"</span><span class="p">.</span><span class="nf">freeze</span><span class="p">)).</span><span class="nf">frozen?</span>
<span class="o">=&gt;</span> <span class="kp">false</span></code></pre></figure>

<h1 id="what-is-the-importance-of-immutable-strings">What is the importance of immutable strings?</h1>

<p>Immutable Strings is being discussed to be the default after Ruby 3.0, however, most of programmers who learnt to program in interpreted language don’t know the importante of this.</p>

<p>If you have already worked with Java or Objective-C, this concept is straightforward, however, Ruby abstracts so easily this concept that is hard no know if you learned programing by Ruby.</p>

<h2 id="less-memmory-allocation-and-faster-code">Less Memmory allocation and faster code</h2>

<p>Less memory is allocated once when a String is immutable. For consequence, your code runs faster because allocating new objects is a costly operation (calling OS for free space, pagination when memory is almost full, so on…).</p>

<h2 id="less-garbage-collector-calls">Less Garbage Collector calls</h2>

<p>Symbols are collected as well as other objects, however, as an special object, is marked to be collected after other objects that lost their reference.</p>

<p>Garbage Collection is a very slow operation, less calls, faster your code is.</p>

<p>You might see all changes in <a href="https://github.com/ruby/ruby/blob/v2_3_0/NEWS">Changelog</a>.</p>


    </div><!-- .post-content -->
    <div class="post-share">
      <span>Share:</span>
      <a target="_blank"
        href="https://twitter.com/intent/tweet?text=Ruby%202.3%20-%20Immutable%20Strings%20Pragma%20/%20Frozen%20Strings&amp;url=http://localhost:4000/programming/2016/01/01/new-in-ruby-2-3-immutable_strings.html" rel="noopener">Twitter</a>
      <a target="_blank"
        href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/programming/2016/01/01/new-in-ruby-2-3-immutable_strings.html&amp;t=Ruby%202.3%20-%20Immutable%20Strings%20Pragma%20/%20Frozen%20Strings" rel="noopener">Facebook</a>
    </div><!-- .share-post -->
    <div class="author-box">
      
      <div class="author-avatar" style="background-image: url('images/author.png')"><span class="screen-reader-text">John Doe's Picture</span></div>
      
      <div class="author-details">
        <h2 class="author-title">About John Doe</h2>
        <div class="author-bio"><p>John is a designer, photographer, speaker, author of a couple of books about typography and the founder of photo magazine Curious.</p>
</div>
        
        <span class="author-location">Vilnius, Lithuania</span>
        
        
        <span class="author-website"><a href="https://justgoodthemes.com" target="_blank" rel="noopener">https://justgoodthemes.com</a></span>
        
      </div><!-- .author-details -->
    </div><!-- .author-box -->
  </article><!-- .post -->

  

</main><!-- .main-content -->
      <footer class="site-footer">
  <div class="offsite-links">
    
  </div><!-- .offsite-links -->
  <div class="footer-bottom">
    <div class="site-info">
      

    </div><!-- .site-info -->
    <a href="#page" id="back-to-top" class="back-to-top"><span class="screen-reader-text">Back to the top </span>&#8593;</a>
  </div><!-- .footer-bottom -->
</footer><!-- .site-footer -->

    </div><!-- .inner -->
  </div><!-- .site -->

  <!-- Scripts -->
  
  <script src="/assets/js/plugins.js"></script>
  <script src="/assets/js/custom.js"></script>

</body>
</html>